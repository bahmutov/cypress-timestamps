name: ci
on: push

jobs:
  test:
    runs-on: ubuntu-24.04
    permissions:
      # allow the release step to comment on
      # issues, pull requests, and write to the repo
      contents: write
      issues: write
      pull-requests: write
      # Required for OIDC to let NPM registry know
      # that this workflow is trusted
      id-token: write

    steps:
      # important: the default Node version is v18
      # which gives us an auth error trying to release
      # so install v24 explicitly
      - uses: actions/setup-node@v6
        with:
          node-version: 24

      - name: Checkout ðŸ›Ž
        # https://github.com/actions/checkout
        uses: actions/checkout@v6

      - name: Run tests ðŸ§ª
        # https://github.com/cypress-io/github-action
        uses: cypress-io/github-action@v6

      - name: Check type declarations ðŸ”Ž
        run: npm run typecheck

      - name: Semantic Release ðŸš€
        # https://github.com/cycjimmy/semantic-release-action
        uses: cycjimmy/semantic-release-action@v6
        with:
          branch: main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
